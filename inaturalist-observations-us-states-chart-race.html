
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="index, follow" />

  <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:ital,wght@0,400;0,700;1,400&family=Source+Sans+Pro:ital,wght@0,300;0,400;0,700;1,400&display=swap" rel="stylesheet">

    <link rel="stylesheet" type="text/css" href="/theme/stylesheet/style.min.css">


    <link id="pygments-light-theme" rel="stylesheet" type="text/css"
          href="/theme/pygments/github.min.css">



  <link rel="stylesheet" type="text/css" href="/theme/font-awesome/css/fontawesome.css">
  <link rel="stylesheet" type="text/css" href="/theme/font-awesome/css/brands.css">
  <link rel="stylesheet" type="text/css" href="/theme/font-awesome/css/solid.css">



  <!-- Chrome, Firefox OS and Opera -->
  <meta name="theme-color" content="#333">
  <!-- Windows Phone -->
  <meta name="msapplication-navbutton-color" content="#333">
  <!-- iOS Safari -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <!-- Microsoft EDGE -->
  <meta name="msapplication-TileColor" content="#333">




 

<meta name="author" content="alex" />
<meta name="description" content="const w = 800; const h = 800; const padding = 30; const appViz = d3.select(&#34;#app&#34;) .append(&#34;svg&#34;) .attr(&#34;width&#34;, w) .attr(&#34;height&#34;, h); const chart = appViz.append(&#34;g&#34;); const xaxisGroup = appViz.append(&#34;g&#34;); const chartLabels = appViz.append(&#34;g&#34;); const titleGroup = appViz.append(&#34;g&#34;); const epochParser = d3.timeParse(&#34;%Q&#34;); const formatMonth = d3 …" />
<meta name="keywords" content="d3, inat, javascript">


  <meta property="og:site_name" content="Alex's Blog"/>
  <meta property="og:title" content="iNaturalist Observations US States Chart Race"/>
  <meta property="og:description" content="const w = 800; const h = 800; const padding = 30; const appViz = d3.select(&#34;#app&#34;) .append(&#34;svg&#34;) .attr(&#34;width&#34;, w) .attr(&#34;height&#34;, h); const chart = appViz.append(&#34;g&#34;); const xaxisGroup = appViz.append(&#34;g&#34;); const chartLabels = appViz.append(&#34;g&#34;); const titleGroup = appViz.append(&#34;g&#34;); const epochParser = d3.timeParse(&#34;%Q&#34;); const formatMonth = d3 …"/>
  <meta property="og:locale" content="en_US"/>
  <meta property="og:url" content="/inaturalist-observations-us-states-chart-race.html"/>
  <meta property="og:type" content="article"/>
  <meta property="article:published_time" content="2022-11-27 22:12:03-08:00"/>
  <meta property="article:modified_time" content=""/>
  <meta property="article:author" content="/author/alex.html">
  <meta property="article:section" content="datavis"/>
  <meta property="article:tag" content="d3"/>
  <meta property="article:tag" content="inat"/>
  <meta property="article:tag" content="javascript"/>
  <meta property="og:image" content="/images/alex_pixel_avatar.jpg">

  <title>Alex's Blog &ndash; iNaturalist Observations US States Chart Race</title>


</head>
<body class="light-theme">

<aside>
  <div>
    <a href="/">
      <img src="/images/alex_pixel_avatar.jpg" alt="Alex" title="Alex">
    </a>

    <h1>
      <a href="/">Alex</a>
    </h1>

    <p>Machine Learning, Art, and other stuff</p>


    <nav>
      <ul class="list">



          <li>
            <a target="_self" href="https://www.inaturalist.org/users/alexshepard" >inat</a>
          </li>
      </ul>
    </nav>

    <ul class="social">
      <li>
        <a class="sc-github"
           href="https://github.com/alexshepard/"
           target="_blank">
          <i class="fa-brands fa-github"></i>
        </a>
      </li>
    </ul>
  </div>

</aside>
  <main>

<nav>
  <a href="/">Home</a>

  <a href="/archives.html">Archives</a>
  <a href="/categories.html">Categories</a>
  <a href="/tags.html">Tags</a>


</nav>

<article class="single">
  <header>
      
    <h1 id="inaturalist-observations-us-states-chart-race">iNaturalist Observations US States Chart Race</h1>
    <p>
      Posted on Sun 27 November 2022 in <a href="/category/datavis.html">datavis</a>

    </p>
  </header>


  <div>
    <script src="https://d3js.org/d3.v7.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/d3-array@3"></script>
<script src="https://cdn.jsdelivr.net/npm/d3-time@3"></script>
<script src="https://cdn.jsdelivr.net/npm/d3-time-format@4"></script>

<div id="app">
</div>

<script>

const w = 800;
const h = 800;
const padding = 30;

const appViz = d3.select("#app")
    .append("svg")
    .attr("width", w)
    .attr("height", h);

const chart = appViz.append("g");
const xaxisGroup = appViz.append("g");
const chartLabels = appViz.append("g");
const titleGroup = appViz.append("g");

const epochParser = d3.timeParse("%Q");
const formatMonth = d3.timeFormat('%Y');

const main = async () => {
    const inatStates = await d3.json("/assets/inat_states_cumsum.json");
    const dateKeys = [];

    for (const [key, value] of Object.entries(inatStates["California"])) {
        dateKeys.push(+key);
    }

    const stateNames = [];
    const productivity = [];

    for (const [stateName, stats] of Object.entries(inatStates)) {
        stateNames.push(stateName);

        const values = [];
        for (const [_date, value] of Object.entries(stats)) {
            values.push(value);
        }

        productivity.push({
            name: stateName,
            values: values,
        });
    }

    const colorScale = d3.scaleOrdinal(d3.schemeCategory10);
    colorScale.domain(stateNames);

    const scaleX = d3.scaleLinear()
        .domain([0, 10]) // domain will adjust each interval
        .range([padding, w - padding])
        .nice();

    let interval = 0;
    setInterval(() => {
        if (interval >= dateKeys.length) {
            return;
        }

        productivity.sort((a, b) => d3.descending(a.values[interval], b.values[interval]));
        productivity.forEach((d, i) => d.rank = i);

        scaleX.domain([0, productivity[0].values[interval]]);

        const scaleY = d3.scaleBand()
            .domain(d3.range(productivity.length))
            .range([padding, h])
            .paddingInner(0.1);

        const t = d3.transition()
            .duration(300)
            .ease(d3.easeLinear);

        chart
            .selectAll("rect")
            .data(productivity, (d) => d.name)
            .join(
                enter => enter
                    .append("rect")
                    .attr("fill", (d) => {
                        return colorScale(d.name);
                    })
                    .attr("x", padding)
                    .attr("y", (d) => scaleY(d.rank))
                    .attr("width", (d) => scaleX(d.values[interval]) - padding)
                    .attr("height", scaleY.bandwidth()),
                update => update
                    .transition(t)
                    .attr("fill", (d) => {
                        return colorScale(d.name);
                    })
                    .attr("x", padding)
                    .attr("y", (d) => scaleY(d.rank))
                    .attr("width", (d) => scaleX(d.values[interval]) - padding)
                    .attr("height", scaleY.bandwidth()),
            )

        const tickValues = [
            10,
            100,
            1_000,
            10_000,
            100_000,
            1_000_000,
            10_000_000,
        ];

        if (productivity[0].values[interval] > 3_000) {
            tickValues.shift();
        }
        if (productivity[0].values[interval] > 30_000) {
            tickValues.shift();
        }
        if (productivity[0].values[interval] > 300_000) {
            tickValues.shift();
        }
        if (productivity[0].values[interval] > 3_000_000) {
            tickValues.shift();
        }
        if (productivity[0].values[interval] > 30_000_000) {
            tickValues.shift();
        }

        xaxisGroup
            .selectAll("g.x-axis")
            .data([null])
            .join("g")
            .transition(t)
            .attr("transform", `translate(0, 28)`)
            .attr("class", "x-axis")
            .call(d3.axisTop(scaleX)
                .tickValues(tickValues)
                .tickSizeOuter(0)
                .tickSizeInner(-1 * h)
            );

        xaxisGroup.selectAll(".tick line").attr("stroke", "white");
        xaxisGroup.select(".domain").remove();

        chartLabels
            .selectAll("text")
            .data(productivity, (d) => d.name)
            .join(
                enter => enter
                    .append("text")
                    .text((d) => d.name)
                    .style("font-size", "0.7em")
                    .attr("fill", (_d, i) => {
                        if (i == 0) {
                            return "white";
                        } else {
                            return "black";
                        }
                    })
                    .attr("text-anchor", (_d, i) => {
                        if (i == 0) {
                            return "end";
                        } else {
                            return "start";
                        }
                    })
                    .attr("alignment-baseline", "baseline")
                    .attr("x", (d, i) => {
                        if (i == 0) {
                            return scaleX(d.values[interval]) - 2;
                        } else {
                            return scaleX(d.values[interval]) + 2;
                        }
                    })
                    .attr("y", (d) => scaleY(d.rank) + 2),
                update => update
                    .transition(t)
                    .text((d) => d.name)
                    .attr("fill", (_d, i) => {
                        if (i == 0) {
                            return "white";
                        } else {
                            return "black";
                        }
                    })
                    .attr("text-anchor", (_d, i) => {
                        if (i == 0) {
                            return "end";
                        } else {
                            return "start";
                        }
                    })
                    .attr("alignment-baseline", "baseline")
                    .attr("x", (d, i) => {
                        if (i == 0) {
                            return scaleX(d.values[interval]) - 2;
                        } else {
                            return scaleX(d.values[interval]) + 2;
                        }
                    })
                    .attr("y", (d) => scaleY(d.rank) + 2),
            );

        const dateKey = dateKeys[interval % dateKeys.length];
        const parsedDate = epochParser(+dateKey)
        const title = formatMonth(parsedDate);
        titleGroup
            .selectAll("text")
            .data([null])
            .join("text")
            .attr("y", 12)
            .attr("x", w / 2)
            .attr("dx", ".35em")
            .attr("fill", "black")
            .attr("text-anchor", "middle")
            .text(`${title} Cumulative iNaturalist Observations, US States`);

        interval++;
    }, 300);
};

main();

</script>
  </div>
  <div class="tag-cloud">
    <p>
      <a href="/tag/d3.html">d3</a>
      <a href="/tag/inat.html">inat</a>
      <a href="/tag/javascript.html">javascript</a>
    </p>
  </div>






</article>

<footer>
<p>&copy; 2024 </p>
<p>
Built with <a href="http://getpelican.com" target="_blank">Pelican</a> using <a href="http://bit.ly/flex-pelican" target="_blank">Flex</a> theme
</p></footer>  </main>

<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " Alex's Blog ",
  "url" : "",
  "image": "/images/alex_pixel_avatar.jpg",
  "description": ""
}
</script>
</body>
</html>