<!DOCTYPE html>
<html lang="en">
<head>
        <title>Alex's Blog : Swift UI Challenge Day</title>
        <meta charset="utf-8" />
        <link rel="stylesheet" href="https://alexshepard.github.io/theme/css/main.css" type="text/css" />
        <link href="https://alexshepard.github.io/None" type="application/atom+xml" rel="alternate" title="Alex's Blog ATOM Feed" />

        <!--[if IE]>
                <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

        <!--[if lte IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="https://alexshepard.github.io/css/ie.css"/>
                <script src="https://alexshepard.github.io/js/IE8.js" type="text/javascript"></script><![endif]-->

        <!--[if lt IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="https://alexshepard.github.io/css/ie6.css"/><![endif]-->

</head>

<body>
        
<header>
    <h1><a href="https://alexshepard.github.io" id="site-title">Alex's Blog </a> :
        <a href="https://alexshepard.github.io/swift-ui-challenge-day.html" id="page-title">Swift UI Challenge Day</a></h1>
<time datetime="2021-06-21T12:55:00-07:00">Mon 21 June 2021</time></header>
<article>
    <p>Fun day today with <a href="https://www.hackingwithswift.com/100/swiftui">100 Days of SwiftUI</a>. The core challenge was very easy, a simpler version of the <a href="https://apps.apple.com/app/apple-store/id1521170681?mt=8">PaperWeight app</a> I've been making with Nicholas.</p>
<p>However, after completing the basic challenge I decided to try using <code>Measurement</code> class to do my conversions. It worked fine, and made for a shorter and probably better solution. However, I tried using the iOS 15 <code>.formatted()</code> method on the converted measurement and while changes to the input length or input units flowed through the state system and triggered an update in the output, changes to the output format didn't seem to affect the computed output, even though the outputUnits was labelled with the <code>@State</code> property wrapper. Maybe the formatter is caching something?</p>
<p>Here's some code to illustrate:</p>
<div class="highlight"><pre><span></span><code><span class="kd">struct</span> <span class="nc">ContentView</span><span class="p">:</span> <span class="n">View</span> <span class="p">{</span>
    <span class="p">@</span><span class="n">State</span> <span class="kd">private</span> <span class="kd">var</span> <span class="nv">inputText</span> <span class="p">=</span> <span class="s">&quot;&quot;</span>
    <span class="p">@</span><span class="n">State</span> <span class="kd">private</span> <span class="kd">var</span> <span class="nv">inputUnits</span> <span class="p">=</span> <span class="mi">0</span>
    <span class="p">@</span><span class="n">State</span> <span class="kd">private</span> <span class="kd">var</span> <span class="nv">outputUnits</span> <span class="p">=</span> <span class="mi">4</span>

    <span class="kd">private</span> <span class="kd">var</span> <span class="nv">appleUnits</span> <span class="p">=</span> <span class="p">[</span>
        <span class="n">UnitLength</span><span class="p">.</span><span class="n">meters</span><span class="p">,</span>
        <span class="n">UnitLength</span><span class="p">.</span><span class="n">kilometers</span><span class="p">,</span>
        <span class="n">UnitLength</span><span class="p">.</span><span class="n">feet</span><span class="p">,</span>
        <span class="n">UnitLength</span><span class="p">.</span><span class="n">yards</span><span class="p">,</span>
        <span class="n">UnitLength</span><span class="p">.</span><span class="n">miles</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="kd">private</span> <span class="kd">var</span> <span class="nv">outputConverted</span><span class="p">:</span> <span class="n">Measurement</span><span class="p">&lt;</span><span class="n">UnitLength</span><span class="p">&gt;</span> <span class="p">{</span>
        <span class="kd">let</span> <span class="nv">numericInput</span><span class="p">:</span> <span class="nb">Double</span> <span class="p">=</span> <span class="nb">Double</span><span class="p">(</span><span class="n">inputText</span><span class="p">)</span> <span class="p">??</span> <span class="mf">0.0</span>

        <span class="kd">let</span> <span class="nv">inputLength</span> <span class="p">=</span> <span class="n">Measurement</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="n">numericInput</span><span class="p">,</span> <span class="n">unit</span><span class="p">:</span> <span class="n">appleUnits</span><span class="p">[</span><span class="n">inputUnits</span><span class="p">])</span>
        <span class="kd">let</span> <span class="nv">outputLength</span> <span class="p">=</span> <span class="n">inputLength</span><span class="p">.</span><span class="n">converted</span><span class="p">(</span><span class="n">to</span><span class="p">:</span> <span class="n">appleUnits</span><span class="p">[</span><span class="n">outputUnits</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">outputLength</span>
    <span class="p">}</span>

    <span class="p">...</span>


    <span class="kd">var</span> <span class="nv">body</span><span class="p">:</span> <span class="n">some</span> <span class="n">View</span> <span class="p">{</span>
        <span class="p">...</span>

        <span class="k">if</span> <span class="cp">#available</span><span class="p">(</span><span class="cp">iOS</span> <span class="mf">15.0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">Text</span><span class="p">(</span><span class="s">&quot;</span><span class="si">\(</span><span class="n">outputConverted</span><span class="p">.</span><span class="n">formatted</span><span class="si">())</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="p">}</span>

    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>In this case, at least with Beta 1 of Xcode, changing the value in <code>inputUnits</code> triggers a full recalculation of the computed variable <code>outputConverted</code> and updates the UI. Changing the value in <code>outputUnits</code> does trigger a recalculation of <code>outputConverted</code> (I can see this with a breakpoint or print), but it doesn't update the UI.</p>
<p>Another day, another challenge with the beta apis for <code>FormatStyle</code>, I guess?</p>
</article>

        <footer>
            <nav>
                <ul>
                    <li>:: <a href="https://alexshepard.github.io/categories.html">Categories</a></li>
                    <li>:: <a href="https://alexshepard.github.io/tags.html">Tags</a></li>
                </ul>
            </nav>
                <p id="theme-credit"><a href="http://mathieu.agopian.info/mnmlist/theme.html">Th√®me mnmlist</a></p>
        </footer>

</body>
</html>